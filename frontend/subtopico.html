<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conjuntos de Estudo - MemoAtivo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <nav id="navbar" class="container">
            <a href="dashboard.html" id="logo">
                <img src="images/MemoAtivo.png" alt="Logo MemoAtivo">
            </a>
            <div class="nav-right">
                <ul id="nav_list">
                    <li class="nav-item"><a href="dashboard.html">Dashboard</a></li>
                    <li class="nav-item"><a href="criar.html">Create</a></li>
                </ul>
                <a href="#" class="nav-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                </a>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="view-header">
                <div class="view-title">
                    <h1 id="pageTitle">A carregar...</h1>
                    <p>Gerencie seus conjuntos de flashcards neste sub-tópico</p>
                </div>
                <!-- ATUALIZADO: O botão agora é um link para a página de geração -->
                <a href="#" id="novoConjuntoBtn" class="btn btn-primary">+ Novo Conjunto com IA</a>
            </div>
            
            <a href="#" id="backLink" class="back-link">← Voltar aos Sub-tópicos</a>
            
            <div class="conjuntos-grid" id="setsGrid">
                <!-- Os conjuntos de estudo serão carregados aqui -->
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const grid = document.getElementById("setsGrid");
            const pageTitle = document.getElementById("pageTitle");
            const backLink = document.getElementById("backLink");
            const novoConjuntoBtn = document.getElementById("novoConjuntoBtn");

            // 1. Lê os parâmetros do URL para saber onde estamos
            const params = new URLSearchParams(window.location.search);
            const categoryId = params.get('catId');
            const categoryName = params.get('catName');
            const subtopicId = params.get('subId');
            const subtopicName = params.get('subName');

            // 2. Valida se todas as informações necessárias estão presentes
            if (!categoryId || !subtopicId || !categoryName || !subtopicName) {
                grid.innerHTML = `<p class="error-message">Informações da categoria ou sub-tópico não encontradas no URL. Volte e tente novamente.</p>`;
                pageTitle.textContent = "Erro de Navegação";
                novoConjuntoBtn.style.display = 'none';
                backLink.style.display = 'none';
                return;
            }

            // 3. Define os títulos e links da página dinamicamente
            pageTitle.textContent = `${subtopicName} - Conjuntos de Estudo`;
            backLink.href = `conjuntos.html?id=${categoryId}&categoria=${encodeURIComponent(categoryName)}`;
            backLink.textContent = `← Voltar aos Sub-tópicos de ${categoryName}`;
            
            // ATUALIZADO: O botão leva para a página de geração, passando todos os parâmetros
            novoConjuntoBtn.href = `gerar-flashcards.html?${params.toString()}`;

            const API_URL = `http://127.0.0.1:5000/api/categories/${categoryId}/subtopics/${subtopicId}/sets`;

            // 4. Busca os conjuntos de estudo do servidor
            async function loadSets() {
                grid.innerHTML = '<p>A carregar conjuntos...</p>';
                try {
                    const response = await fetch(API_URL);
                    if (!response.ok) throw new Error(`Erro na rede: ${response.status}`);
                    const sets = await response.json();
                    renderSets(sets);
                } catch (error) {
                    console.error("Erro ao carregar conjuntos:", error);
                    grid.innerHTML = `<p class="error-message">Não foi possível carregar os conjuntos. Verifique se o servidor está em execução.</p>`;
                }
            }

            // 5. Desenha os cards dos conjuntos de estudo no ecrã
            function renderSets(sets) {
                grid.innerHTML = '';
                if (sets.length === 0) {
                    grid.innerHTML = '<p>Nenhum conjunto de estudo encontrado. Clique em "+ Novo Conjunto com IA" para criar o primeiro!</p>';
                    return;
                }
                sets.forEach(set => {
                    const cardHTML = `
                        <article class="set-card">
                            <div>
                                <h3>${set.name}</h3>
                                <div class="set-stats">
                                    <div class="stat-item">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
                                        <span>${set.totalCards} cards</span>
                                        ${set.cardsToReview > 0 ? `<span class="tag-revisao">${set.cardsToReview} para revisar</span>` : ''}
                                    </div>
                                    <div class="stat-item">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                                        <span>Ainda não estudado</span>
                                    </div>
                                </div>
                            </div>
                            <div class="set-footer">
                                <a href="estudar.html?setId=${set.id}" class="btn btn-primary">
                                    Estudar Agora
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                                </a>
                            </div>
                        </article>`;
                    grid.insertAdjacentHTML('beforeend', cardHTML);
                });
            }

            // Inicia o processo ao carregar a página
            loadSets();
        });
    </script>

</body>
</html>

